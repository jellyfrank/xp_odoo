# 第五章 日记账

## 日记帐的序号规则

Odoo 在启用 会计不可篡改性（尤其是欧盟合规、审计链）时，会要求:

**每一条已过账的会计分录，必须能唯一地找到“上一条已过账分录”**

用于计算：

* 哈希 / 顺序链
* 审计追溯
* 防止删除、插入、乱序修改

即确保日记帐中的会计凭证号码都是连续的，不会出现跳号的情况。

Odoo的每个版本在实现这条规则时有不同的处理方法，例如在odoo15中时通过一个**安全序列号**(secure sequence number)来实现的，而在从17.0开始则更换了实现方式，不再使用原有的序列号(sequence)规则，而是从数据库中既有的记录计算而来。也因此，我们在碰见如下错误时要根据不同的版本二采区不同的处理策略：

```py
An error occurred when computing the inalterability. Impossible to get the unique previous posted journal entry
```

此错误的含义是，日记账的凭证中出现了缺失的序号，可能的原因是凭证被误删，也可能数据库错误导致。
